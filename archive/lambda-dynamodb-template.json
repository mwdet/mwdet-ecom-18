{
	"AWSTemplateFormatVersion": "2010-09-09",
	"Transform": "AWS::Serverless-2016-10-31",
	"Description": "This is the AWS Lambda functions",
	"Parameters": {
		"Environment": {
			"Type": "String",
			"Description": "This key is used for environment",
			"Default": "dev"
		},
		"Alias": {
			"Type": "String",
			"Description": "This key is used for Alias",
			"Default": "dev"
		}
	},
	"Mappings": {
		"EnvironmentMap": {
			"dev": {
				"tableName": "megha_customers"
			}
		}
	},
	"Resources": {
		"customerDynamoDBTable": {
			"Type": "AWS::DynamoDB::Table",
			"Properties": {
				"AttributeDefinitions": [{
					"AttributeName": "id",
					"AttributeType": "S"
				}],
				"KeySchema": [{
					"AttributeName": "id",
					"KeyType": "HASH"
				}],
				"ProvisionedThroughput": {
					"ReadCapacityUnits": "1",
					"WriteCapacityUnits": "1"
				},
				"TableName": {
					"Fn::Join": [
						"_",
						[
							"megha_customers",
							{
								"Ref": "Environment"
							}
						]
					]
				}
			}
		},
		"meghacrudfunctionalityFunction": {
			"Type": "AWS::Serverless::Function",
			"DependsOn": "customerDynamoDBTable",
			"Properties": {
				"Handler": "index.handler",
				"CodeUri": "./lambdas/getaccount/src",
				"FunctionName": {
					"Fn::Join": [
						"-",
						[
							"megha-crud-functionality",
							{
								"Ref": "Alias"
							}
						]
					]
				},
				"Description": "put customer data",
				"Runtime": "nodejs14.x",
				"Environment": {
					"Variables":{
          			"TABLE_NAME": {
						"Fn::FindInMap": [
							"EnvironmentMap",
							{
								"Ref": "Environment"
							},
							"tableName"
						]
					}
					}
				},
				"Role": {
					"Fn::FindInMap": [
						"EnvironmentMap",
						{
							"Ref": "Environment"
						},
						"role"
					]
				},
				
				"MemorySize": 128,
				"Timeout": 300
			}
		},
		"meghacrudfunctionalityFunctionPermission": {
			"Type": "AWS::Lambda::Permission",
			"DependsOn": "meghacrudfunctionalityFunction",
			"Properties": {
				"Action": "lambda:InvokeFunction",
				"FunctionName": {
					"Ref": "meghacrudfunctionalityFunction"
				},
				"Principal": "apigateway.amazonaws.com"
			}
		},
		"CustomerServicesAPI": {
			"Type": "AWS::Serverless::Api",
			"DeletionPolicy": "Retain",
			"Properties": {
				"DefinitionUri": "swagger.yaml",
				"StageName": {
					"Ref": "Environment"
				}
			}
		}
	},
	"Outputs": {
		"CustomerServicesAPI": {
			"Description": "Web API URI",
			"Value": {
				"Fn::Join": [
					"",
					[
						"https://",
						{
							"Ref": "CustomerServicesAPI"
						},
						".execute-api.",
						{
							"Ref": "AWS::Region"
						},
						".amazonaws.com"
					]
				]
			}
		}
	}
}